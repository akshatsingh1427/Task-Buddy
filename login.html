<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task Buddy Login</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  position: relative;
  overflow: hidden;
}

body::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="%23ffffff10" points="0,1000 1000,0 1000,1000"/></svg>');
  background-size: cover;
}


.login-container {
  background: rgba(255, 255, 255, 0.95);
  padding: 3rem;
  border-radius: 24px;
  text-align: center;
  width: 420px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
  position: relative;
  z-index: 1;
  animation: slideUp 0.6s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}


h1 {
  margin-bottom: 2rem;
  color: #4a5568;
  font-size: 2.2rem;
  font-weight: 700;
  background: linear-gradient(135deg, #667eea, #764ba2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}


.user-icon {
  margin-bottom: 2rem;
}

.user-icon .icon-wrapper {
  width: 100px;
  height: 100px;
  background: linear-gradient(135deg, #667eea, #764ba2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
}

.user-icon i {
  font-size: 2.5rem;
  color: white;
}


.input-group {
  position: relative;
  margin-bottom: 1.5rem;
}

.input-group i {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: #a0aec0;
  z-index: 2;
}

input {
  width: 100%;
  padding: 1rem 1rem 1rem 3rem;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  background: white;
  font-size: 1rem;
  outline: none;
  color: #4a5568;
  font-weight: 500;
  transition: all 0.3s ease;
}

input:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  transform: translateY(-2px);
}

input.error {
  border-color: #f56565;
  box-shadow: 0 0 0 3px rgba(245, 101, 101, 0.1);
}


.btn-group {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-top: 2rem;
}

.login-btn, .create-btn {
  padding: 1rem 2rem;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1.1rem;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.login-btn {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.login-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.login-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.create-btn {
  background: transparent;
  color: #667eea;
  border: 2px solid #e2e8f0;
}

.create-btn:hover {
  background: #f7fafc;
  border-color: #667eea;
  transform: translateY(-2px);
}

#error {
  margin-top: 1rem;
  padding: 0.75rem;
  background: #fed7d7;
  color: #c53030;
  border-radius: 8px;
  font-size: 0.9rem;
  display: none;
  animation: shake 0.5s ease-in-out;
  border: 1px solid #feb2b2;
}

#error.show {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}


.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid #ffffff;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}


.success {
  background: linear-gradient(135deg, #48bb78, #38a169) !important;
}


@media (max-width: 480px) {
  .login-container {
    width: 90%;
    padding: 2rem;
    margin: 1rem;
  }
  
  h1 {
    font-size: 1.8rem;
  }
}
</style>
</head>

<body>

<div class="login-container">

  <h1>Welcome to Task Buddy <i class="fas fa-tasks"></i></h1>

  <div class="user-icon">
    <div class="icon-wrapper">
      <i class="fas fa-user"></i>
    </div>
  </div>

  <div class="input-group">
    <i class="fas fa-user"></i>
    <input type="text" id="username" placeholder="Username" autocomplete="username" required>
  </div>

  <div class="input-group">
    <i class="fas fa-lock"></i>
    <input type="password" id="password" placeholder="Password" autocomplete="current-password" required>
  </div>

  <div class="btn-group">
    <button class="login-btn" onclick="login()" id="login-btn">
      <i class="fas fa-sign-in-alt"></i> Sign In
    </button>
    <button class="create-btn" onclick="window.location.href='signup.html'">
      <i class="fas fa-user-plus"></i> Create Account
    </button>
  </div>

  <div id="error">
    <i class="fas fa-exclamation-circle"></i> 
    <span id="error-message">Incorrect username or password</span>
  </div>

</div>

<script>

if(localStorage.getItem("loggedIn") === "true" && localStorage.getItem("username")){
    window.location.href = "index.html";
}

async function login() {
    const usernameInput = document.getElementById("username");
    const passwordInput = document.getElementById("password");
    const loginBtn = document.getElementById("login-btn");
    const errorDiv = document.getElementById("error");
    const errorMessage = document.getElementById("error-message");

    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();

    
    errorDiv.classList.remove('show');
    usernameInput.classList.remove('error');
    passwordInput.classList.remove('error');

    
    let hasError = false;
    
    if (!username) {
        errorMessage.textContent = "Please enter username";
        usernameInput.classList.add('error');
        hasError = true;
    }

    if (!password) {
        errorMessage.textContent = "Please enter password";
        passwordInput.classList.add('error');
        hasError = true;
    }

    if (hasError) {
        errorDiv.classList.add('show');
        return;
    }

    loginBtn.innerHTML = '<div class="loading"></div> Signing In...';
    loginBtn.disabled = true;

    try {
        console.log('Sending login request for:', username);
        
        const response = await fetch('http://127.0.0.1:8080/login', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ 
                username: username, 
                password: password 
            })
        });
        
        console.log('Response status:', response.status);
        
        let result;
        try {
            result = await response.json();
            console.log('Response data:', result);
        } catch (parseError) {
            console.error('Failed to parse response:', parseError);
            throw new Error('Invalid server response');
        }
        
        if (response.ok && result.message === "Login successful") {
            
            console.log('Login successful, storing user data');
            
            localStorage.setItem("loggedIn", "true");
            localStorage.setItem("username", username);
            
            
            loginBtn.innerHTML = '<i class="fas fa-check"></i> Success!';
            loginBtn.classList.add('success');
            
            setTimeout(() => {
                window.location.href = "index.html";
            }, 1000);
            
        } else {
          
            const errorMsg = result.error || "Invalid username or password";
            console.log('Login failed:', errorMsg);
            
            errorMessage.textContent = errorMsg;
            errorDiv.classList.add('show');
            usernameInput.classList.add('error');
            passwordInput.classList.add('error');
            
         
            loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
            loginBtn.disabled = false;
            loginBtn.classList.remove('success');
        }
    } catch (error) {
        console.error('Login error:', error);
        errorMessage.textContent = "Backend server not running. Please start the server.";
        errorDiv.classList.add('show');
        
       
        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
        loginBtn.disabled = false;
        loginBtn.classList.remove('success');
    }
}

document.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        login();
    }
});

document.getElementById('username').addEventListener('input', function() {
    this.classList.remove('error');
    document.getElementById('error').classList.remove('show');
});

document.getElementById('password').addEventListener('input', function() {
    this.classList.remove('error');
    document.getElementById('error').classList.remove('show');
});

window.addEventListener('load', function() {
    if (!document.referrer.includes('login.html') && !document.referrer.includes('signup.html')) {
        localStorage.removeItem("loggedIn");
        localStorage.removeItem("username");
    }
});
</script>

</body>
</html>